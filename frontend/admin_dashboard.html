<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="header">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" onclick="logoutAdmin()">Logout</button>
  </div>

  <div class="table-wrapper">
    <h2>Registered Users</h2>
    <table id="userTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Timestamp</th>
          <th>Login Count</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const BASE_URL = "http://127.0.0.1:8000"; 

    async function loadAdminDashboard() {
      const adminLoggedIn = localStorage.getItem("admin_logged_in");

      if (!adminLoggedIn) {
        alert("Admin not logged in!");
        window.location.href = "index.html";
        return;
      }

      try {
        const response = await fetch(`${BASE_URL}/admin/users`);
        const data = await response.json();

        const tbody = document.querySelector("#userTable tbody");
        tbody.innerHTML = "";

        if (response.ok) {
          data.forEach(user => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${user.id}</td>
              <td>${user.first_name}</td>
              <td>${user.last_name}</td>
              <td>${user.email}</td>
              <td>${user.timestamp || "â€”"}</td>
              <td>${user.login_count || 0}</td>
            `;
            tbody.appendChild(row);
          });
        } else {
          alert("Error loading users: " + (data.detail || "Unknown error"));
        }
      } catch (error) {
        console.error("Error fetching users:", error);
        alert("Failed to connect to backend.");
      }
    }

    function logoutAdmin() {
      localStorage.removeItem("admin_logged_in");
      window.location.href = "index.html";
    }

    loadAdminDashboard();
  </script>
</body>
</html>
